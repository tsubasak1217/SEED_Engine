// state
#include "GameState_Title.h"
#include "GameState_Select.h"

////////////////////////////////////////////////////////////////////////////////////////
//
// コンストラクタ：デストラクタ
//
////////////////////////////////////////////////////////////////////////////////////////
GameState_Title::GameState_Title(Scene_Base* pScene) : State_Base(pScene){
    pGameScene_ = dynamic_cast< Scene_Game* >(pScene);
    Initialize();

}

GameState_Title::~GameState_Title(){
    pGameScene_->Get_pPlayer()->SetIsApplyGravity(true);
}

////////////////////////////////////////////////////////////////////////////////////////
//
// 初期化処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Title::Initialize(){
    pGameScene_->Get_pStageManager()->GetTitleStage()->InitializeStatus("resources/jsons/Stages/stage_title.json");
    // 操作フラグをfalseにしておく
    Vector3 initializePlayerPos = StageManager::GetTitleStartPos();
    pGameScene_->Get_pPlayer()->SetPosition(StageManager::GetTitleStartPos());
    pGameScene_->Get_pPlayer()->SetIsMovable(false);
    pGameScene_->Get_pPlayer()->SetIsApplyGravity(false);
    pGameScene_->Get_pCamera()->SetTarget(pGameScene_->Get_pPlayer());

    // イベントシーンがあれば終了
    pGameScene_->EndEvent();
}

////////////////////////////////////////////////////////////////////////////////////////
//
// 終了処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Title::Finalize(){}

////////////////////////////////////////////////////////////////////////////////////////
//
// 更新処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Title::Update(){
    StageManager::GetTitleStage()->Update();
}

////////////////////////////////////////////////////////////////////////////////////////
//
// 描画処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Title::Draw(){
    // タイトル画面の描画処理
    StageManager::GetTitleStage()->Draw();

}

////////////////////////////////////////////////////////////////////////////////////////
//
// フレーム開始処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Title::BeginFrame(){}

////////////////////////////////////////////////////////////////////////////////////////
//
// フレーム終了処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Title::EndFrame(){
    ManageState();
}

////////////////////////////////////////////////////////////////////////////////////////
//
// コライダーをCollisionManagerに渡す
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Title::HandOverColliders(){}

////////////////////////////////////////////////////////////////////////////////////////
//
// ステート管理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Title::ManageState(){
    // タイトル画面のステート管理
    // 遷移
   //pGameScene_->ChangeState(new GameState_Select(pGameScene_));
}