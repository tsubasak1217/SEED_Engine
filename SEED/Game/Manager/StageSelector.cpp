#include "StageSelector.h"
#include "InputManager/InputManager.h"
#include "ClockManager.h"

///////////////////////////////////////////////////////////////////////////
// 初期化処理
///////////////////////////////////////////////////////////////////////////
void StageSelector::Initialize(){}

///////////////////////////////////////////////////////////////////////////
// 終了処理
///////////////////////////////////////////////////////////////////////////
void StageSelector::Finalize(){}

///////////////////////////////////////////////////////////////////////////
// 更新処理
///////////////////////////////////////////////////////////////////////////
void StageSelector::Update(){
    Select();
    CameraUpdate();
    DecideStage();
}

///////////////////////////////////////////////////////////////////////////
// 描画処理
///////////////////////////////////////////////////////////////////////////
void StageSelector::Draw(){}

///////////////////////////////////////////////////////////////////////////
// フレーム開始時の処理
///////////////////////////////////////////////////////////////////////////
void StageSelector::BeginFrame(){}

///////////////////////////////////////////////////////////////////////////
// フレーム終了時の処理
///////////////////////////////////////////////////////////////////////////
void StageSelector::EndFrame(){}

///////////////////////////////////////////////////////////////////////////
// ステージ選択処理
///////////////////////////////////////////////////////////////////////////
void StageSelector::Select(){

    // スティックの入力からステージを選択
    if(Input::IsTriggerStick(LR::LEFT, DIRECTION::RIGHT)){
        pStageManager_->StepStage(1);
        pCamera_->SetPhi(3.14f * 0.3f);
        pCamera_->SetDistance(80.0f);
    } else if(Input::IsTriggerStick(LR::LEFT, DIRECTION::LEFT)){
        pStageManager_->StepStage(-1);
        pCamera_->SetPhi(3.14f * 0.3f);
        pCamera_->SetDistance(80.0f);
    }
}

///////////////////////////////////////////////////////////////////////////
// カメラの更新
///////////////////////////////////////////////////////////////////////////
void StageSelector::CameraUpdate(){

    static float additionTheta = 3.14f / 360.0f;

    // ステージから注目点を取得
    BaseObject* pTarget = pStageManager_->GetCurrentStage()->GetViewPoint();

    // 注目点をカメラにセット
    if(pTarget){
        pCamera_->SetTarget(pTarget);
    }

    // カメラの角度を変更
    pCamera_->AddTheta(additionTheta * ClockManager::TimeRate());
}

///////////////////////////////////////////////////////////////////////////
// ステージの決定
///////////////////////////////////////////////////////////////////////////
void StageSelector::DecideStage(){
    if(Input::IsTriggerPadButton(PAD_BUTTON::A)){
        isDecided_ = true;
    }
}
