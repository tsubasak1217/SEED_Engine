#include "SceneManager.h"
#include "Scene_Game.h"
#include "Scene_Title/Scene_Title.h"
#include "Scene_Clear/Scene_Clear.h"
#include "CollisionManaer/CollisionManager.h"

///////////////////////////////////////////////////////////////////////////////
// static変数
///////////////////////////////////////////////////////////////////////////////
SceneManager* SceneManager::instance_ = nullptr;
std::unique_ptr<Scene_Base> SceneManager::pScene_ = nullptr;

///////////////////////////////////////////////////////////////////////////////
// コンストラクタ・デストラクタ
///////////////////////////////////////////////////////////////////////////////
SceneManager::SceneManager(){
    pScene_.reset(new Scene_Game(instance_));
}

SceneManager::~SceneManager(){
    delete instance_;
    instance_ = nullptr;
}

///////////////////////////////////////////////////////////////////////////////
// 初期化
///////////////////////////////////////////////////////////////////////////////
void SceneManager::Initialize(){
    instance_ = GetInstance();
}

///////////////////////////////////////////////////////////////////////////////
// 更新
///////////////////////////////////////////////////////////////////////////////
void SceneManager::Update(){
    // Colliderのリセット
    CollisionManager::ResetColliderList();
    // シーンの更新
    pScene_->Update();
    // シーン更新終了後にカメラを更新
    CameraManager::Update();
    // 当たり判定
    CollisionManager::CheckCollision();
}

///////////////////////////////////////////////////////////////////////////////
// 描画
///////////////////////////////////////////////////////////////////////////////
void SceneManager::Draw(){
    pScene_->Draw();
    CollisionManager::Draw();
}

///////////////////////////////////////////////////////////////////////////////
// フレーム終了処理
///////////////////////////////////////////////////////////////////////////////
void SceneManager::EndFrame(){
    pScene_->EndFrame();
}


///////////////////////////////////////////////////////////////////////////////
// インスタンス取得
///////////////////////////////////////////////////////////////////////////////
SceneManager* SceneManager::GetInstance(){

    if(!instance_){
        instance_ = new SceneManager();
    }

    return instance_;
}

///////////////////////////////////////////////////////////////////////////////
// シーン変更
///////////////////////////////////////////////////////////////////////////////
void SceneManager::ChangeScene(Scene_Base* newScene){
    pScene_.reset(newScene);
}
