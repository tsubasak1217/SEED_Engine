#include "GameState_Select.h"
#include "GameState_Play.h"
#include "Scene_Game.h"


////////////////////////////////////////////////////////////////////////////////////////
//
// コンストラクタ：デストラクタ
//
////////////////////////////////////////////////////////////////////////////////////////
GameState_Select::GameState_Select(Scene_Base* pScene) : State_Base(pScene){
    pGameScene_ = dynamic_cast<Scene_Game*>(pScene);
    Initialize();
}

GameState_Select::~GameState_Select(){}

////////////////////////////////////////////////////////////////////////////////////////
//
// 初期化処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Select::Initialize(){
    stageSelector_ = std::make_unique<StageSelector>();
    stageSelector_->SetStageManager(pGameScene_->Get_pStageManager());
    stageSelector_->SetCamera(pGameScene_->Get_pCamera());

    // 操作フラグをfalseにしておく
    pGameScene_->Get_pPlayer()->SetIsMovable(false);

    // spriteの初期化
    frame_ = std::make_unique<Sprite>("SelectScene/frame.png");
    stageName_ = std::make_unique<Sprite>("SelectScene/stageNames.png");

    for(int i = 0; i < 2; i++){
        arrow_[i] = std::make_unique<Sprite>("SelectScene/arrow_normal.png");
        arrow_[i]->anchorPoint = { 0.5f, 0.5f };
        arrow_[i]->translate = { 190.0f + i * 900.0f,kWindowCenter.y };
    }

    for(int i = 0; i < 3; i++){
        collectionStars_[i] = std::make_unique<Sprite>("SelectScene/star.png");
    }

    for(int i = 0; i < 5; i++){
        difficultyEggs_[i] = std::make_unique<Sprite>("SelectScene/egg.png");
    }

}

////////////////////////////////////////////////////////////////////////////////////////
//
// 終了処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Select::Finalize(){}

////////////////////////////////////////////////////////////////////////////////////////
//
// 更新処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Select::Update(){
    stageSelector_->Update();
}

////////////////////////////////////////////////////////////////////////////////////////
//
// 描画処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Select::Draw(){
    stageSelector_->Draw();
    frame_->Draw();
}

////////////////////////////////////////////////////////////////////////////////////////
//
// フレーム開始処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Select::BeginFrame(){}

////////////////////////////////////////////////////////////////////////////////////////
//
// フレーム終了処理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Select::EndFrame(){}

////////////////////////////////////////////////////////////////////////////////////////
//
// コライダーをCollisionManagerに渡す
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Select::HandOverColliders(){}


////////////////////////////////////////////////////////////////////////////////////////
//
// ステート管理
//
////////////////////////////////////////////////////////////////////////////////////////
void GameState_Select::ManageState(){

    // ステージが決定されたらプレイステートに遷移
    if(stageSelector_->GetIsDecided()){
        pGameScene_->ChangeState(new GameState_Play(pGameScene_));
    }
}
